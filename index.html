<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Futebol 2D com Dois Joysticks</title>
  <style>
    body {
      margin: 0;
      background: #4CAF50;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #87CEEB;
      border: 5px solid #333;
    }
    #placar {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-family: Arial;
      font-size: 24px;
      color: white;
    }
    #joystick-mover, #joystick-chutar {
      position: absolute;
      bottom: 20px;
    }
    #joystick-mover {
      left: 20px;
    }
    #joystick-chutar {
      right: 20px;
    }
  </style>
</head>
<body>
  <div id="placar">Gols: 0 | Tempo: 60</div>
  <canvas id="campo" width="800" height="500"></canvas>
  <div id="joystick-mover"></div>
  <div id="joystick-chutar"></div>

  <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.js"></script>
  <script>
    const canvas = document.getElementById('campo');
    const ctx = canvas.getContext('2d');
    const placar = document.getElementById('placar');

    const jogador = { x: 100, y: 250, w: 20, h: 20, cor: '#00FF00', vel: 4 };
    const bola = { x: 400, y: 250, r: 10, cor: '#FFD700', vel: 5, vx: 0, vy: 0 };
    const adversario = { x: 600, y: 250, w: 20, h: 20, cor: '#0000FF', vel: 2 };
    const goleiro = { x: 770, y: 240, w: 10, h: 20, cor: '#FF0000', vel: 2, dir: 1 };
    const baliza = { x: 780, y: 200, w: 20, h: 100 };

    let dx = 0, dy = 0;
    let chuteX = 0, chuteY = 0;
    let gols = 0;
    let tempo = 60;
    let bolaColada = false;

    function desenharCampo() {
      ctx.fillStyle = '#4CAF50';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(baliza.x, baliza.y, baliza.w, baliza.h);
    }

    function desenharEntidade(e) {
      ctx.fillStyle = e.cor;
      ctx.fillRect(e.x, e.y, e.w, e.h);
    }

    function desenharBola() {
      ctx.beginPath();
      ctx.arc(bola.x, bola.y, bola.r, 0, Math.PI * 2);
      ctx.fillStyle = bola.cor;
      ctx.fill();
      ctx.closePath();
    }

    function moverJogador() {
      jogador.x += dx * jogador.vel;
      jogador.y += dy * jogador.vel;
      jogador.x = Math.max(0, Math.min(canvas.width - jogador.w, jogador.x));
      jogador.y = Math.max(0, Math.min(canvas.height - jogador.h, jogador.y));
    }

    function moverBola() {
      if (bolaColada) {
        bola.x = jogador.x + jogador.w / 2;
        bola.y = jogador.y + jogador.h / 2;
      } else {
        bola.x += bola.vx;
        bola.y += bola.vy;
        bola.vx *= 0.95;
        bola.vy *= 0.95;
      }
      bola.x = Math.max(bola.r, Math.min(canvas.width - bola.r, bola.x));
      bola.y = Math.max(bola.r, Math.min(canvas.height - bola.r, bola.y));
    }

    function moverAdversario() {
      const ang = Math.atan2(bola.y - adversario.y, bola.x - adversario.x);
      adversario.x += Math.cos(ang) * adversario.vel;
      adversario.y += Math.sin(ang) * adversario.vel;
    }

    function moverGoleiro() {
      goleiro.y += goleiro.vel * goleiro.dir;
      if (goleiro.y < baliza.y || goleiro.y + goleiro.h > baliza.y + baliza.h) {
        goleiro.dir *= -1;
      }
    }

    function colide(a, b) {
      return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
      );
    }

    function verificarContato() {
      const distX = bola.x - (jogador.x + jogador.w / 2);
      const distY = bola.y - (jogador.y + jogador.h / 2);
      const dist = Math.sqrt(distX * distX + distY * distY);
      if (dist < 25) bolaColada = true;
    }

    function verificarGol() {
      if (
        bola.x + bola.r > baliza.x &&
        bola.y > baliza.y &&
        bola.y < baliza.y + baliza.h &&
        !colide(bola, goleiro)
      ) {
        gols++;
        bola.x = 400;
        bola.y = 250;
        bola.vx = 0;
        bola.vy = 0;
        bolaColada = false;
      }
    }

    function atualizarPlacar() {
      placar.textContent = `Gols: ${gols} | Tempo: ${tempo}`;
    }

    function loop() {
      desenharCampo();
      moverJogador();
      moverBola();
      moverAdversario();
      moverGoleiro();
      verificarContato();
      verificarGol();
      desenharEntidade(jogador);
      desenharEntidade(adversario);
      desenharEntidade(goleiro);
      desenharBola();
      atualizarPlacar();
      requestAnimationFrame(loop);
    }

    setInterval(() => {
      if (tempo > 0) tempo--;
    }, 1000);

    // Joystick de movimento
    const mover = nipplejs.create({
      zone: document.getElementById('joystick-mover'),
      mode: 'static',
      position: { left: '60px', bottom: '60px' },
      color: 'white'
    });

    mover.on('move', (evt, data) => {
      if (data && data.vector) {
        dx = data.vector.x;
        dy = data.vector.y;
      }
    });

    mover.on('end', () => {
      dx = 0;
      dy = 0;
    });

    // Joystick de chute
    const chutar = nipplejs.create({
      zone: document.getElementById('joystick-chutar'),
      mode: 'static',
      position: { right: '60px', bottom: '60px' },
      color: 'red'
    });

    chutar.on('move', (evt, data) => {
      if (bolaColada && data && data.vector) {
        chuteX = data.vector.x;
        chuteY = data.vector.y;
        bola.vx = chuteX * 10;
        bola.vy = chuteY * 10;
        bolaColada = false;
      }
    });

    loop();
  </script>
</body>
</html>
